{% extends "common/base.html" %}

{% block title %}Class Management{% endblock %}

{% block extra_styles %}
        .class-card {
            border-left: 4px solid #667eea;
        }
        .grade-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .subject-badge {
            background: #e9ecef;
            color: #495057;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 500;
        }
{% endblock %}

{% block content %}
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-md-8">
                <h2><i class="fas fa-book me-2"></i>Class Management</h2>
                <p class="text-muted">Manage your classes organized by subject and grade level</p>
            </div>
            <div class="col-md-4 text-end">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createClassModal">
                    <i class="fas fa-plus me-2"></i>Create New Class
                </button>
            </div>
        </div>

        <!-- Classes Grid -->
        <div class="row">
            {% for class in classes %}
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card class-card h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <h5 class="card-title mb-0">{{ class.name }}</h5>
                                <span class="grade-badge">Grade {{ class.grade_level }}</span>
                            </div>
                            
                            <div class="mb-3">
                                <span class="subject-badge">{{ class.subject_name }}</span>
                            </div>
                            
                            {% if class.description %}
                                <p class="card-text text-muted">{{ class.description }}</p>
                            {% endif %}
                            
                            <div class="row text-center mb-3">
                                <div class="col-6">
                                    <small class="text-muted">Students</small>
                                    <div class="fw-bold">{{ class.student_count or 0 }}</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Resources</small>
                                    <div class="fw-bold">{{ class.resource_count or 0 }}</div>
                                </div>
                            </div>
                            
                            <div class="d-grid gap-2">
                                <button class="btn btn-outline-primary btn-sm" onclick="viewClass({{ class.id }})">
                                    <i class="fas fa-eye me-1"></i>View Details
                                </button>
                                <button class="btn btn-outline-success btn-sm" onclick="manageStudents({{ class.id }})">
                                    <i class="fas fa-users me-1"></i>Manage Students
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="col-12">
                    <div class="card">
                        <div class="card-body text-center py-5">
                            <i class="fas fa-book fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">No classes yet</h5>
                            <p class="text-muted">Create your first class to get started!</p>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createClassModal">
                                <i class="fas fa-plus me-2"></i>Create Class
                            </button>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Create Class Modal -->
        <div class="modal fade" id="createClassModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Create New Class</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="createClassForm">
                            <div class="mb-3">
                                <label for="className" class="form-label">Class Name *</label>
                                <input type="text" class="form-control" id="className" required>
                            </div>
                            <div class="mb-3">
                                <label for="classSubject" class="form-label">Subject *</label>
                                <select class="form-select" id="classSubject" required>
                                    <option value="">Select Subject</option>
                                    <!-- Subjects will be populated here -->
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="classGrade" class="form-label">Grade Level *</label>
                                <select class="form-select" id="classGrade" required>
                                    <option value="">Select Grade</option>
                                    {% for grade in range(1, 13) %}
                                    <option value="{{ grade }}">Grade {{ grade }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="classDescription" class="form-label">Description</label>
                                <textarea class="form-control" id="classDescription" rows="3"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="createClassBtn">
                            <i class="fas fa-plus me-2"></i>Create Class
                        </button>
                    </div>
                </div>
            </div>
        </div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Create new class
    document.getElementById('createClassBtn').addEventListener('click', function() {
        const name = document.getElementById('className').value;
        const subject = document.getElementById('classSubject').value;
        const grade = document.getElementById('classGrade').value;
        const description = document.getElementById('classDescription').value;

        if (!name || !subject || !grade) {
            alert('Please fill in all required fields');
            return;
        }

        const classData = {
            name: name,
            subject_id: subject,
            grade_level: grade,
            description: description
        };

        fetch('/api/create_class', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(classData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Class created successfully!');
                location.reload();
            } else {
                alert('Failed to create class: ' + (data.error || 'Unknown error'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred');
        });
    });

    function viewClass(classId) {
        // TODO: Implement class details view
        alert('View class details for ID: ' + classId);
    }

    function manageStudents(classId) {
        // TODO: Implement student management for class
        alert('Manage students for class ID: ' + classId);
    }
</script>
{% endblock %}